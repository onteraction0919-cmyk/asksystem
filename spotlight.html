<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>방송 질문</title>
<style>
  :root{--bg:#ffffff;--txt:#111111}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,sans-serif}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:8vh 6vw;position:relative}
  .q{font-size:min(5.2vw,64px);line-height:1.25;font-weight:700;white-space:pre-wrap;word-break:keep-all;text-align:left}
  .time{position:fixed;left:24px;bottom:24px;font-size:14px;color:#444}
  .logo{position:fixed;right:24px;bottom:24px;max-width:min(18vw,220px);opacity:.92;display:none}
  .empty{opacity:.35;font-weight:600}
</style>
</head>
<body>
  <div class="wrap">
    <div class="q empty" id="q">방송 대기 중…</div>
    <div class="time" id="t"></div>
    <img class="logo" id="logo" src="/static/logo.png" alt="logo"
         onload="this.style.display='block'">
  </div>
<script>
const $q = document.getElementById('q');
const $t = document.getElementById('t');

function show(item){
  if(item && item.text){
    $q.classList.remove('empty');
    $q.textContent = item.text;
    $t.textContent = new Date(item.ts || Date.now()).toLocaleString();
  }else{
    $q.classList.add('empty');
    $q.textContent = '방송 대기 중…';
    $t.textContent = '';
  }
}

// WS 실시간
let ws;
function connect(){
  ws = new WebSocket((location.protocol==='https:'?'wss':'ws')+'://'+location.host);
  ws.onmessage = (e)=>{
    try{
      const m = JSON.parse(e.data);
      if(m.type==='spotlight') show(m.item);
    }catch(_){}
  };
  ws.onclose = ()=> setTimeout(connect, 1500);
}
connect();

// 폴백(혹시 WS 막히면 3초마다 확인)
setInterval(async ()=>{
  try{
    const r = await fetch('/api/questions').then(r=>r.json());
    const items = r.items||[];
    const cur = items[0]; // 최신 하나 추정 X → WS가 오피셜. 폴백은 방송중인 id가 없으니 생략.
  }catch(_){}
}, 3000);
</script>
</body>
</html>
