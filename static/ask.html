<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>질문 등록</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1420; --panel:#171c29; --ink:#e8ecf4; --sub:#9aa4b2; --accent:#6d7cff;
    --muted:#0c111b;
  }
  *{box-sizing:border-box;}
  body{margin:0; font-family:Pretendard, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--ink);}
  .wrap{max-width:980px; margin:40px auto; padding:24px; background:var(--panel); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
  h1{margin:0 0 18px; font-size:28px;}
  .ta{width:100%; min-height:240px; background:#0e1320; color:#dbe7ff; border:1px solid #232a3a; border-radius:12px; padding:18px; font-size:18px; line-height:1.65; outline:none;}
  .row{display:flex; gap:8px; align-items:center; margin-top:16px; color:var(--sub);}
  .btn{background:var(--accent); color:white; border:none; border-radius:12px; padding:10px 18px; font-size:15px; cursor:pointer;}
  .link{color:#b8c0ff; text-decoration:none;}
  .list{margin-top:26px; background:var(--muted); border:1px solid #22293a; border-radius:14px; padding:12px;}
  .item{padding:14px 12px; border-bottom:1px dashed #283049; display:grid; grid-template-columns:1fr auto; gap:12px;}
  .item:last-child{border-bottom:none;}
  .time{color:#97a2b5; font-size:13px; margin-top:6px;}
  .del{background:#394155; color:#e9f1ff; border:none; border-radius:10px; padding:8px 12px; cursor:pointer;}
  .empty{color:#7f8aa3; padding:18px;}
</style>
</head>
<body>
  <div class="wrap">
    <h1>질문 등록</h1>
    <textarea id="ta" class="ta" placeholder="질문을 입력하고 ‘등록’을 누르세요.&#10;가능하면 한 문장으로 간결하게 써 주세요."></textarea>
    <div class="row">
      <button id="submit" class="btn">등록</button>
      <span>사회자 페이지: <a class="link" href="/mod" target="_blank">/mod</a> · 방송화면: <a class="link" href="/spotlight" target="_blank">/spotlight</a></span>
    </div>

    <div class="list">
      <div id="list"></div>
    </div>
  </div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  const socket = io();

  const ta = document.getElementById('ta');
  const btn = document.getElementById('submit');
  const list = document.getElementById('list');

  function render(questions){
    if(!questions.length){
      list.innerHTML = '<div class="empty">아직 등록된 질문이 없습니다.</div>';
      return;
    }
    list.innerHTML = questions.map(q => `
      <div class="item">
        <div>
          <div>${escapeHTML(q.text)}</div>
          <div class="time">${q.ts}</div>
        </div>
        <button class="del" data-id="${q.id}">삭제</button>
      </div>
    `).join('');
  }

  function escapeHTML(s){return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}

  btn.onclick = () => {
    const text = ta.value.trim();
    if(!text) return;
    socket.emit('question:add', text);
    ta.value = '';
  };

  list.addEventListener('click', (e)=>{
    const id = e.target.dataset.id;
    if(e.target.classList.contains('del') && id){
      socket.emit('question:delete', id);
    }
  });

  socket.on('init', ({questions}) => render(questions));
  socket.on('questions:update', render);
</script>
</body>
</html>
