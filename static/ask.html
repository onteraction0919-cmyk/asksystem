<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>질문 등록</title>
<style>
:root{
  --bg:#0b1020;--panel:#121a2d;--accent:#7f89ff;
  --text:#e7eeff;--muted:#9db1d1aa;--danger:#ff5470;
}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans KR","Malgun Gothic",sans-serif;}
.wrap{max-width:1080px;margin:48px auto;padding:0 20px}
h1{margin:0 0 18px}
.card{background:var(--panel);border-radius:14px;padding:18px 22px;}
textarea{width:100%;height:220px;background:#0e1430;border:1px solid #223058;border-radius:12px;
  color:var(--text);padding:18px 20px;font-size:18px;line-height:1.6;}
.row{display:flex;gap:12px;align-items:center;margin-top:14px}
.btn{background:var(--accent);color:#fff;border:0;border-radius:12px;padding:12px 18px;font-weight:700}
.list{margin-top:28px}
.q{background:#0e1430;border:1px solid #23335c;border-radius:12px;padding:14px 16px;margin:10px 0;
  display:flex;justify-content:space-between;align-items:center;}
.btn-del{background:transparent;color:var(--danger);border:1px solid #3f2b38;border-radius:10px;padding:8px 12px}
.muted{color:var(--muted)}
.nav{margin-bottom:12px}
.nav a{color:#b6c6ff;margin-right:8px;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <a href="/mod">사회자 패널</a> · <a href="/spotlight">방송 화면</a>
  </div>
  <h1>질문 등록</h1>
  <div class="card">
    <textarea id="ta" placeholder="질문을 입력하고 ‘등록’을 누르세요."></textarea>
    <div class="row">
      <button id="btn" class="btn">등록</button>
      <span class="muted">사회자: /mod · 방송: /spotlight</span>
    </div>
  </div>
  <div id="list" class="list"></div>
</div>

<script>
const $=s=>document.querySelector(s);
const ta=$("#ta"), btn=$("#btn"), list=$("#list");

btn.onclick=async()=>{
  const text=ta.value.trim();
  if(!text)return;
  btn.disabled=true;
  await fetch("/api/questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text})});
  ta.value="";btn.disabled=false;
}

list.onclick=async(e)=>{
  const id=e.target.dataset.del;
  if(!id)return;
  if(!confirm("삭제할까요?"))return;
  await fetch(`/api/questions/${id}`,{method:"DELETE"});
}

function render(qs){
  list.innerHTML=qs.map(q=>{
    const d=new Date(q.createdAt);
    const t=d.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    return `<div class="q"><div>${escapeHTML(q.text)}</div><small>${t}</small>
    <button class='btn-del' data-del='${q.id}'>삭제</button></div>`
  }).join("")||`<div class='muted'>등록된 질문이 없습니다.</div>`;
}

const es=new EventSource("/sse");
es.addEventListener("init",e=>render(JSON.parse(e.data).questions));
es.addEventListener("questions",e=>render(JSON.parse(e.data)));

function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}
</script>
</body>
</html>
