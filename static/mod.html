<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>사회자 질문 선택</title>
  <style>
    :root{
      --bg:#0e1320; --ink:#eaf0ff; --muted:#a1acd6; --card:#12182b;
      --brand:#7a68ff; --danger:#ff5d7a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Pretendard,Arial,sans-serif}
    .wrap{max-width:1100px;margin:48px auto;padding:0 20px}
    h1{margin:0 0 16px}
    .toolbar{display:flex;gap:10px;align-items:center;margin-bottom:16px}
    .btn{background:var(--brand);color:#fff;border:0;border-radius:10px;padding:8px 14px;cursor:pointer;font-weight:700}
    .btn.muted{background:#2b3350}
    .btn.danger{background:var(--danger)}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    .card{
      background:var(--card);border:1px solid #1f2942;border-radius:14px;padding:14px 14px;display:flex;gap:10px;align-items:flex-start
    }
    .q{flex:1;white-space:pre-wrap;line-height:1.55}
    .meta{color:var(--muted);font-size:12px;margin-top:6px}
    .actions{display:flex;gap:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>사회자 질문 선택</h1>
    <div class="toolbar">
      <button class="btn muted" onclick="spotlightClear()">방송 해제</button>
      <div class="meta">방송화면: <b>/spotlight</b></div>
    </div>
    <div id="list" class="grid"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const ioClient = io();
    const elList = document.getElementById('list');

    const fmt = ts => {
      const d = new Date(ts);
      const z=n=>String(n).padStart(2,'0');
      return `${z(d.getMonth()+1)}/${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}`;
    };

    function render(list){
      elList.innerHTML = list.map(q => `
        <div class="card">
          <div class="q">
            ${q.text.replace(/&/g,'&amp;').replace(/</g,'&lt;')}
            <div class="meta">${fmt(q.createdAt)}</div>
          </div>
          <div class="actions">
            <button class="btn" onclick="spotlight('${q.id}')">방송 표시</button>
            <button class="btn danger" onclick="delQ('${q.id}')">삭제</button>
          </div>
        </div>
      `).join('') || '<div class="meta">등록된 질문이 없습니다.</div>';
    }

    async function spotlight(id){
      await fetch('/api/spotlight', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ id })
      });
    }
    async function spotlightClear(){
      await fetch('/api/spotlight/clear', { method:'POST' });
    }
    async function delQ(id){
      if(!confirm('삭제할까요?')) return;
      await fetch(`/api/questions/${id}`, { method:'DELETE' });
    }

    ioClient.on('questions:update', render);
  </script>
</body>
</html>
