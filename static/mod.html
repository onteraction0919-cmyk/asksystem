<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>사회자 패널</title>
<style>
:root{
  --bg:#0b1020;--text:#e7eeff;--muted:#9db1d1bb;
  --card:#0e1430;--line:#25345d;--accent:#7f89ff;
  --good:#00d3a7;--danger:#ff5470;
}
body{margin:0;background:var(--bg);color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans KR","Malgun Gothic",sans-serif;}
.wrap{max-width:1280px;margin:36px auto;padding:0 20px}
h1{margin:0 0 18px}
.bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.btn{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn-a{background:var(--accent);color:#fff}
.btn-g{background:var(--good);color:#03231d}
.btn-d{background:transparent;color:var(--danger);border:1px solid #452737}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(360px,1fr))}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px 14px}
.active{outline:2px solid var(--good)}
.txt{white-space:pre-wrap;line-height:1.5}
.row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="bar">
    <h1>사회자 질문 선택</h1>
    <div>
      <a href="/ask" class="btn">질문 등록</a>
      <a href="/spotlight" class="btn">방송 화면</a>
      <button id="clear" class="btn btn-d">전체삭제</button>
    </div>
  </div>
  <div id="grid" class="grid"></div>
</div>

<script>
const grid=document.getElementById("grid");let activeId=null;
function render(qs){
  grid.innerHTML=qs.map(q=>{
    const d=new Date(q.createdAt);
    const t=d.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    const act=q.id===activeId?"active":"";
    return `<div class="card ${act}" data-id="${q.id}">
      <div class="txt">${escapeHTML(q.text)}</div>
      <div class="row">
        <small>${t}</small>
        <div>
          <button class='btn btn-g' data-show='${q.id}'>방송표시</button>
          <button class='btn btn-d' data-del='${q.id}'>삭제</button>
        </div>
      </div></div>`;
  }).join("")||"<div class='muted'>질문이 없습니다.</div>";
}
grid.onclick=async(e)=>{
  const idS=e.target.dataset.show,idD=e.target.dataset.del;
  if(idS)await fetch(`/api/spotlight/${idS}`,{method:"POST"});
  if(idD&&confirm("삭제할까요?"))await fetch(`/api/questions/${idD}`,{method:"DELETE"});
}
document.getElementById("clear").onclick=async()=>{
  if(confirm("전체 삭제할까요?"))await fetch("/api/questions",{method:"DELETE"});
}
const es=new EventSource("/sse");
es.addEventListener("init",e=>{const d=JSON.parse(e.data);activeId=d.activeId;render(d.questions);});
es.addEventListener("questions",e=>render(JSON.parse(e.data)));
es.addEventListener("spotlight",e=>{
  activeId=JSON.parse(e.data).activeId;
  document.querySelectorAll(".card").forEach(el=>el.classList.toggle("active",el.dataset.id===activeId));
});
function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}
</script>
</body>
</html>
