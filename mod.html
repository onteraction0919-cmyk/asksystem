<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>사회자 질문 선택</title>
  <style>
    :root{--bg:#0b0b12;--panel:#121225;--line:#212144;--accent:#6f4ef6;--ok:#72ffad}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,Segoe UI,Apple SD Gothic Neo,Malgun Gothic,sans-serif;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 20px;border-bottom:1px solid var(--line);position:sticky;top:0;background:rgba(11,11,18,.8);backdrop-filter:saturate(140%) blur(8px)}
    h1{margin:0;font-size:clamp(18px,3.5vw,26px)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;padding:16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px}
    .txt{font-size:clamp(16px,2.3vw,20px);line-height:1.45;white-space:pre-wrap}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .btn{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#151532;color:#d8d8f8;cursor:pointer}
    .btn.primary{background:var(--accent);border:none;color:#fff;font-weight:700}
    .active{outline:2px solid var(--ok)}
    .logo{position:fixed;right:16px;bottom:16px;opacity:.85}
    .logo img{height:22px;filter:drop-shadow(0 1px 2px rgba(0,0,0,.5))}
    .pill{border:1px solid var(--line);padding:8px 10px;border-radius:999px;color:#c9c9ff}
    .actions{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <header>
    <h1>사회자 질문 선택</h1>
    <div class="actions">
      <span class="pill" id="count">0개</span>
      <button class="btn" id="refresh">새로고침</button>
    </div>
  </header>

  <main class="grid" id="list"></main>
  <div class="logo"><img src="/static/logo.png" onerror="this.style.display='none'"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const list = document.getElementById("list");
    const count = document.getElementById("count");

    async function getJSON(u){ const r = await fetch(u); return r.json(); }
    async function post(u,d){ const r = await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}); return r.json(); }

    async function load(){
      const data = await getJSON("/api/questions");
      render(data.items||[]);
    }

    function render(items){
      list.innerHTML = "";
      count.textContent = `${items.length}개`;
      items.forEach(q=>{
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="txt">${escapeHtml(q.text)}</div>
          <div class="row">
            <small style="opacity:.7">${new Date(q.createdAt).toLocaleTimeString()}</small>
            <div class="actions">
              <button class="btn primary" data-id="${q.id}">방송 표시</button>
            </div>
          </div>
        `;
        list.appendChild(el);
      });
      list.querySelectorAll(".primary").forEach(b=>{
        b.onclick = async () => {
          const id = Number(b.dataset.id);
          const res = await post("/api/spotlight",{id});
          if(res.ok){
            [...document.querySelectorAll(".card")].forEach(c=>c.classList.remove("active"));
            b.closest(".card").classList.add("active");
          }
        };
      });
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
    }

    document.getElementById("refresh").onclick = load;

    // 실시간 반영
    const socket = io();
    socket.on("new_question", () => load());

    // 첫 로드
    load();
  </script>
</body>
</html>
