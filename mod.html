<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>사회자 질문 선택</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<style>
  :root{
    --bg:#0e101a; --card:#171b2e; --text:#e8ecff; --sub:#9aa5d1;
    --brand:#5b4bff; --ok:#4ad1a8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,pretendard,Arial,sans-serif}
  header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:#0b0d16;position:sticky;top:0;z-index:5;border-bottom:1px solid #222740}
  header h1{font-size:18px;margin:0}
  header .btns{display:flex;gap:8px}
  .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .ghost{background:#1a1f37;color:#cbd4ff}
  .danger{background:#2d2233;color:#ff6d91}
  main{max-width:1400px;margin:0 auto;padding:18px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  @media (max-width:1200px){ .grid{grid-template-columns:repeat(2,1fr);} }
  @media (max-width:720px){ .grid{grid-template-columns:1fr;} }
  .card{background:var(--card);border:1px solid #20264a;border-radius:18px;padding:18px;display:flex;flex-direction:column;gap:12px;min-height:180px}
  .title{font-size:15px;font-weight:700;color:#b9c3ff}
  .text{font-size:18px;line-height:1.6;white-space:pre-wrap;word-break:keep-all}
  .meta{font-size:12px;color:var(--sub)}
  .actions{margin-top:auto;display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:8px 12px;border-radius:999px;border:0;cursor:pointer;font-weight:700}
  .broad{background:var(--brand);color:#fff}
  .sel{background:var(--ok);color:#001a14}
  .def{background:#2a2f48;color:#cfe2ff}
  .outline{background:transparent;border:1px solid #39406a;color:#cbd4ff}
  .active{box-shadow:0 0 0 2px #8c82ff inset}
</style>
</head>
<body>
<header>
  <h1>사회자 질문 선택</h1>
  <div class="btns">
    <button class="btn ghost" id="refresh">새로고침</button>
    <button class="btn danger" id="clearSpot">방송 비우기</button>
  </div>
</header>

<main>
  <div id="count" style="margin:0 0 12px 2px;color:#9aa5d1;font-size:14px;">—</div>
  <div class="grid" id="list"></div>
</main>

<script>
const socket = io();
const $list = document.getElementById('list');
const $count = document.getElementById('count');
let state = { questions:[], currentSpotlight:null };

function fmt(ts){ const d=new Date(ts);const z=n=>String(n).padStart(2,'0');return `${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;}

function render(){
  $count.textContent = `총 ${state.questions.length}건 / 방송중: ${state.currentSpotlight ? state.currentSpotlight.id : '없음'}`;
  $list.innerHTML = '';
  state.questions.forEach(q=>{
    const el = document.createElement('div');
    el.className = 'card' + (state.currentSpotlight && state.currentSpotlight.id===q.id ? ' active':'');

    el.innerHTML = `
      <div class="title">질문 #${q.id} · <span style="color:#9aa5d1">${fmt(q.ts)}</span></div>
      <div class="text">${q.text.replace(/</g,'&lt;')}</div>
      <div class="meta">상태: ${q.status}</div>
      <div class="actions">
        <button class="pill broad">방송 표시</button>
        <button class="pill sel">선택</button>
        <button class="pill def">대기</button>
        <button class="pill outline">미방송</button>
      </div>
    `;
    const [bBroad,bSel,bDef,bClear] = el.querySelectorAll('button');
    bBroad.onclick = ()=> socket.emit('spotlight:set', { id:q.id });
    bSel.onclick   = ()=> socket.emit('mod:updateStatus', { id:q.id, status:'selected' });
    bDef.onclick   = ()=> socket.emit('mod:updateStatus', { id:q.id, status:'deferred' });
    bClear.onclick = ()=> socket.emit('spotlight:clear');

    $list.appendChild(el);
  });
}

socket.emit('init:please');
socket.on('init:data',  d=>{ state=d; render(); });
socket.on('mod:list:update', qs=>{ state.questions=qs; render(); });
socket.on('spotlight:update', s=>{ state.currentSpotlight=s; render(); });

document.getElementById('refresh').onclick = ()=> socket.emit('init:please');
document.getElementById('clearSpot').onclick = ()=> socket.emit('spotlight:clear');
</script>
</body>
</html>
